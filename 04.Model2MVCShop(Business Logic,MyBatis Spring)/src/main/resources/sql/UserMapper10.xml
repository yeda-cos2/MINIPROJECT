<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 					
<mapper namespace="UserMapper10">

	<!-- SELECT 매핑구분에서 사용할 ResultSet과 바인딩 될 비지니스 객체 명시적 저으이 -->
	<resultMap id="userSelectMap" type="user">
	  <result property="userId" column="user_id" jdbcType="VARCHAR"/>
	  <result property="userName" column="user_name" jdbcType="VARCHAR"/>
	  <result property="password" column="password" jdbcType="VARCHAR"/>
	  <result property="role" column="role" jdbcType="VARCHAR"/>
	  <result property="ssn" column="ssn" jdbcType="VARCHAR"/>
	  <result property="phone" column="CELL_PHONE" jdbcType="VARCHAR"/>
	  <result property="addr" column="addr" jdbcType="VARCHAR"/>
	  <result property="email" column="email" jdbcType="VARCHAR"/>
	  <result property="regDate" column="reg_date" jdbcType="DATE"/>
	</resultMap>
  	
  	
  	<insert 	id="addUser"  parameterType="user">
 	  INSERT
		INTO users(user_id, user_name, password, role, ssn, CELL_PHONE, ADDR,EMAIL,reg_date)
		VALUES( #{userId}, #{userName}, #{password},'user',#{ssn},#{phone},#{addr},#{email}, sysdate )	
	</insert>
	
	<select id = "getUser" parameterType="string" resultMap="userSelectMap">
	SELECT
	user_id ,  user_name ,  password , role , cell_phone ,  addr ,  email , reg_date 
	FROM users
	WHERE user_id=#{value}
	</select>
	
	
	<update 	id="updateUser"  parameterType="user">
 	  UPDATE users
		<set>
		<if test = "userName != null">user_name=#{userName},</if>
 	    <if test = "phone != null">cell_phone=#{phone},</if>
 	    <if test = "addr != null">addr=#{addr},</if>
 	    <if test = "email != null">email=#{email}</if>
 	  WHERE user_id=#{userId}
		</set>
	</update>
  	
  	
  	<sql id="select-users">
  		SELECT
		user_id, user_name, email
		FROM users
  	</sql>
  	
  	
  	<sql id="orderby-userId-desc">
  		ORDER BY user_id
  	</sql>
  	
  	
  	<select id ="getUserList" parameterType="mybatis.service.domain.Search" resultMap="userSelectMap">
  	<include refid="select-users"/>
  	<where>
  	
  	<choose>
  	<when test="searchCondition == 'userId' ">
  	<if test="userId.size != 0">
  	user_id IN
 	 <foreach item="value" collection="userId" open="(" separator="," close=")">
  	 #{value}
  	 </foreach>
  	</if>
  	</when>
  	
  	
  <when test="searchCondition == 'userName' ">
  	<if test="userName[0] != null">
  	user_name IN
 	 <foreach item="value" collection="userName" open="(" separator="," close=")">
  	 #{value}
  	 </foreach>
  	</if>
  	</when>
  	
  	
  	
  	</choose>
  	
  	<!--  //위의 <choose>는 아래와 같이 변경 가능
  	
  	<if test="searchCondition == 'userId' ">
  	<if test="userId.size != 0">
  	user_id IN
 	 <foreach item="value" collection="userId" open="(" separator="," close=")">
  	 #{value}
  	 </foreach>
  	</if>
  	</if>
  <if test="searchCondition == 'userName' ">
  	<if test="userName[0] != null">
  	user_name IN
 	 <foreach item="value" collection="userName" open="(" separator="," close=")">
  	 #{value}
  	 </foreach>
  	</if>
  	</if> -->
  
  	</where>
  	<include refid="orderby-userId-desc"/>
  	</select>	  	
</mapper>